<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MD5å®ç°å¯¹æ¯”æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        .result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
        }
        .success { background: #d4edda; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; }
        .warning { background: #fff3cd; border: 1px solid #ffeaa7; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        .comparison-table th, .comparison-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .comparison-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .match { background: #d4edda; }
        .mismatch { background: #f8d7da; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” MD5å®ç°å¯¹æ¯”æµ‹è¯•</h1>
        <p>å¯¹æ¯”æ’ä»¶è‡ªå®šä¹‰MD5å®ç°ä¸CryptoJSåº“çš„MD5å®ç°</p>
        
        <div class="test-section">
            <h3>ğŸ§ª æµ‹è¯•æ§åˆ¶</h3>
            <button onclick="runAllTests()">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            <button onclick="testBaiduSignature()">æµ‹è¯•ç™¾åº¦APIç­¾å</button>
            <button onclick="clearResults()">æ¸…é™¤ç»“æœ</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ“Š æµ‹è¯•ç»“æœ</h3>
            <div id="results"></div>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”§ ç™¾åº¦APIç­¾åæµ‹è¯•</h3>
            <div>
                <label>APP ID: <input type="text" id="testAppId" value="test_app_id" style="margin: 5px; padding: 5px;"></label><br>
                <label>APP Key: <input type="text" id="testAppKey" value="test_app_key" style="margin: 5px; padding: 5px;"></label><br>
                <label>æŸ¥è¯¢æ–‡æœ¬: <input type="text" id="testQuery" value="hello world" style="margin: 5px; padding: 5px;"></label><br>
                <label>Salt: <input type="text" id="testSalt" value="1234567890" style="margin: 5px; padding: 5px;"></label><br>
                <button onclick="testCustomSignature()">æµ‹è¯•è‡ªå®šä¹‰ç­¾å</button>
            </div>
            <div id="signatureResults"></div>
        </div>
    </div>

    <!-- å¼•å…¥CryptoJSåº“ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    
    <script>
        // æ’ä»¶ä¸­çš„è‡ªå®šä¹‰MD5å®ç°ï¼ˆä»content.jså¤åˆ¶ï¼‰
        function customMD5(string) {
            function rotateLeft(value, amount) {
                return (value << amount) | (value >>> (32 - amount));
            }

            function addUnsigned(x, y) {
                const lsw = (x & 0xFFFF) + (y & 0xFFFF);
                const msw = (x >> 16) + (y >> 16) + (lsw >> 16);
                return (msw << 16) | (lsw & 0xFFFF);
            }

            function md5cmn(q, a, b, x, s, t) {
                return addUnsigned(rotateLeft(addUnsigned(addUnsigned(a, q), addUnsigned(x, t)), s), b);
            }

            function md5ff(a, b, c, d, x, s, t) {
                return md5cmn((b & c) | ((~b) & d), a, b, x, s, t);
            }

            function md5gg(a, b, c, d, x, s, t) {
                return md5cmn((b & d) | (c & (~d)), a, b, x, s, t);
            }

            function md5hh(a, b, c, d, x, s, t) {
                return md5cmn(b ^ c ^ d, a, b, x, s, t);
            }

            function md5ii(a, b, c, d, x, s, t) {
                return md5cmn(c ^ (b | (~d)), a, b, x, s, t);
            }

            function coreMD5(x, len) {
                x[len >> 5] |= 0x80 << ((len) % 32);
                x[(((len + 64) >>> 9) << 4) + 14] = len;

                let a = 1732584193;
                let b = -271733879;
                let c = -1732584194;
                let d = 271733878;

                for (let i = 0; i < x.length; i += 16) {
                    const olda = a;
                    const oldb = b;
                    const oldc = c;
                    const oldd = d;

                    a = md5ff(a, b, c, d, x[i + 0], 7, -680876936);
                    d = md5ff(d, a, b, c, x[i + 1], 12, -389564586);
                    c = md5ff(c, d, a, b, x[i + 2], 17, 606105819);
                    b = md5ff(b, c, d, a, x[i + 3], 22, -1044525330);
                    a = md5ff(a, b, c, d, x[i + 4], 7, -176418897);
                    d = md5ff(d, a, b, c, x[i + 5], 12, 1200080426);
                    c = md5ff(c, d, a, b, x[i + 6], 17, -1473231341);
                    b = md5ff(b, c, d, a, x[i + 7], 22, -45705983);
                    a = md5ff(a, b, c, d, x[i + 8], 7, 1770035416);
                    d = md5ff(d, a, b, c, x[i + 9], 12, -1958414417);
                    c = md5ff(c, d, a, b, x[i + 10], 17, -42063);
                    b = md5ff(b, c, d, a, x[i + 11], 22, -1990404162);
                    a = md5ff(a, b, c, d, x[i + 12], 7, 1804603682);
                    d = md5ff(d, a, b, c, x[i + 13], 12, -40341101);
                    c = md5ff(c, d, a, b, x[i + 14], 17, -1502002290);
                    b = md5ff(b, c, d, a, x[i + 15], 22, 1236535329);

                    a = md5gg(a, b, c, d, x[i + 1], 5, -165796510);
                    d = md5gg(d, a, b, c, x[i + 6], 9, -1069501632);
                    c = md5gg(c, d, a, b, x[i + 11], 14, 643717713);
                    b = md5gg(b, c, d, a, x[i + 0], 20, -373897302);
                    a = md5gg(a, b, c, d, x[i + 5], 5, -701558691);
                    d = md5gg(d, a, b, c, x[i + 10], 9, 38016083);
                    c = md5gg(c, d, a, b, x[i + 15], 14, -660478335);
                    b = md5gg(b, c, d, a, x[i + 4], 20, -405537848);
                    a = md5gg(a, b, c, d, x[i + 9], 5, 568446438);
                    d = md5gg(d, a, b, c, x[i + 14], 9, -1019803690);
                    c = md5gg(c, d, a, b, x[i + 3], 14, -187363961);
                    b = md5gg(b, c, d, a, x[i + 8], 20, 1163531501);
                    a = md5gg(a, b, c, d, x[i + 13], 5, -1444681467);
                    d = md5gg(d, a, b, c, x[i + 2], 9, -51403784);
                    c = md5gg(c, d, a, b, x[i + 7], 14, 1735328473);
                    b = md5gg(b, c, d, a, x[i + 12], 20, -1926607734);

                    a = md5hh(a, b, c, d, x[i + 5], 4, -378558);
                    d = md5hh(d, a, b, c, x[i + 8], 11, -2022574463);
                    c = md5hh(c, d, a, b, x[i + 11], 16, 1839030562);
                    b = md5hh(b, c, d, a, x[i + 14], 23, -35309556);
                    a = md5hh(a, b, c, d, x[i + 1], 4, -1530992060);
                    d = md5hh(d, a, b, c, x[i + 4], 11, 1272893353);
                    c = md5hh(c, d, a, b, x[i + 7], 16, -155497632);
                    b = md5hh(b, c, d, a, x[i + 10], 23, -1094730640);
                    a = md5hh(a, b, c, d, x[i + 13], 4, 681279174);
                    d = md5hh(d, a, b, c, x[i + 0], 11, -358537222);
                    c = md5hh(c, d, a, b, x[i + 3], 16, -722521979);
                    b = md5hh(b, c, d, a, x[i + 6], 23, 76029189);
                    a = md5hh(a, b, c, d, x[i + 9], 4, -640364487);
                    d = md5hh(d, a, b, c, x[i + 12], 11, -421815835);
                    c = md5hh(c, d, a, b, x[i + 15], 16, 530742520);
                    b = md5hh(b, c, d, a, x[i + 2], 23, -995338651);

                    a = md5ii(a, b, c, d, x[i + 0], 6, -198630844);
                    d = md5ii(d, a, b, c, x[i + 7], 10, 1126891415);
                    c = md5ii(c, d, a, b, x[i + 14], 15, -1416354905);
                    b = md5ii(b, c, d, a, x[i + 5], 21, -57434055);
                    a = md5ii(a, b, c, d, x[i + 12], 6, 1700485571);
                    d = md5ii(d, a, b, c, x[i + 3], 10, -1894986606);
                    c = md5ii(c, d, a, b, x[i + 10], 15, -1051523);
                    b = md5ii(b, c, d, a, x[i + 1], 21, -2054922799);
                    a = md5ii(a, b, c, d, x[i + 8], 6, 1873313359);
                    d = md5ii(d, a, b, c, x[i + 15], 10, -30611744);
                    c = md5ii(c, d, a, b, x[i + 6], 15, -1560198380);
                    b = md5ii(b, c, d, a, x[i + 13], 21, 1309151649);
                    a = md5ii(a, b, c, d, x[i + 4], 6, -145523070);
                    d = md5ii(d, a, b, c, x[i + 11], 10, -1120210379);
                    c = md5ii(c, d, a, b, x[i + 2], 15, 718787259);
                    b = md5ii(b, c, d, a, x[i + 9], 21, -343485551);

                    a = addUnsigned(a, olda);
                    b = addUnsigned(b, oldb);
                    c = addUnsigned(c, oldc);
                    d = addUnsigned(d, oldd);
                }
                return [a, b, c, d];
            }

            function utf8Encode(string) {
                string = string.replace(/\r\n/g, "\n");
                let utftext = "";
                for (let n = 0; n < string.length; n++) {
                    const c = string.charCodeAt(n);
                    if (c < 128) {
                        utftext += String.fromCharCode(c);
                    } else if ((c > 127) && (c < 2048)) {
                        utftext += String.fromCharCode((c >> 6) | 192);
                        utftext += String.fromCharCode((c & 63) | 128);
                    } else {
                        utftext += String.fromCharCode((c >> 12) | 224);
                        utftext += String.fromCharCode(((c >> 6) & 63) | 128);
                        utftext += String.fromCharCode((c & 63) | 128);
                    }
                }
                return utftext;
            }

            function convertToWordArray(string) {
                const wordArray = [];
                const len = string.length * 8;
                for (let i = 0; i < len; i += 8) {
                    wordArray[i >> 5] |= (string.charCodeAt(i / 8) & 0xFF) << (i % 32);
                }
                return { words: wordArray, sigBytes: len / 8 };
            }

            function wordToHex(word) {
                let hex = "";
                for (let i = 0; i < 4; i++) {
                    const byte = (word >>> (i * 8)) & 0xFF;
                    hex += ((byte < 16) ? "0" : "") + byte.toString(16);
                }
                return hex;
            }

            const utf8String = utf8Encode(string);
            const wordArray = convertToWordArray(utf8String);
            const hash = coreMD5(wordArray.words, utf8String.length * 8);
            
            return wordToHex(hash[0]) + wordToHex(hash[1]) + wordToHex(hash[2]) + wordToHex(hash[3]);
        }

        // ç”Ÿæˆç­¾åå‡½æ•°
        function generateCustomSign(appid, query, salt, key) {
            const str = appid + query + salt + key;
            return customMD5(str);
        }

        function generateCryptoJSSign(appid, query, salt, key) {
            const str = appid + query + salt + key;
            return CryptoJS.MD5(str).toString();
        }

        // æµ‹è¯•ç”¨ä¾‹
        const testCases = [
            'hello',
            'hello world',
            'ä½ å¥½ä¸–ç•Œ',
            'The quick brown fox jumps over the lazy dog',
            'è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•å­—ç¬¦ä¸²',
            '',
            'a',
            '123456789',
            'test_app_idhello world1234567890test_app_key'
        ];

        function runAllTests() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<h4>ğŸ”„ æ­£åœ¨è¿è¡Œæµ‹è¯•...</h4>';
            
            let html = '<table class="comparison-table">';
            html += '<tr><th>æµ‹è¯•å­—ç¬¦ä¸²</th><th>è‡ªå®šä¹‰MD5</th><th>CryptoJS MD5</th><th>ç»“æœ</th></tr>';
            
            let passCount = 0;
            let totalCount = testCases.length;
            
            testCases.forEach((testString, index) => {
                const customResult = customMD5(testString);
                const cryptoResult = CryptoJS.MD5(testString).toString();
                const isMatch = customResult === cryptoResult;
                
                if (isMatch) passCount++;
                
                html += `<tr class="${isMatch ? 'match' : 'mismatch'}">`;
                html += `<td>${testString || '(ç©ºå­—ç¬¦ä¸²)'}</td>`;
                html += `<td style="font-family: monospace;">${customResult}</td>`;
                html += `<td style="font-family: monospace;">${cryptoResult}</td>`;
                html += `<td>${isMatch ? 'âœ… åŒ¹é…' : 'âŒ ä¸åŒ¹é…'}</td>`;
                html += '</tr>';
            });
            
            html += '</table>';
            
            const summary = `<div class="result ${passCount === totalCount ? 'success' : 'error'}">`;
            html = summary + `<h4>ğŸ“Š æµ‹è¯•æ€»ç»“: ${passCount}/${totalCount} é€šè¿‡</h4></div>` + html;
            
            resultsDiv.innerHTML = html;
        }

        function testBaiduSignature() {
            const appId = 'test_app_id';
            const appKey = 'test_app_key';
            const query = 'hello world';
            const salt = '1234567890';
            
            const customSign = generateCustomSign(appId, query, salt, appKey);
            const cryptoSign = generateCryptoJSSign(appId, query, salt, appKey);
            
            const signatureDiv = document.getElementById('signatureResults');
            
            let html = '<h4>ğŸ” ç™¾åº¦APIç­¾åå¯¹æ¯”</h4>';
            html += `<div class="result"><strong>æ‹¼æ¥å­—ç¬¦ä¸²:</strong> ${appId + query + salt + appKey}</div>`;
            html += `<div class="result"><strong>è‡ªå®šä¹‰MD5ç­¾å:</strong> <code>${customSign}</code></div>`;
            html += `<div class="result"><strong>CryptoJS MD5ç­¾å:</strong> <code>${cryptoSign}</code></div>`;
            
            const isMatch = customSign === cryptoSign;
            html += `<div class="result ${isMatch ? 'success' : 'error'}">`;
            html += `<strong>ç­¾åå¯¹æ¯”ç»“æœ:</strong> ${isMatch ? 'âœ… åŒ¹é…' : 'âŒ ä¸åŒ¹é…'}`;
            html += '</div>';
            
            signatureDiv.innerHTML = html;
        }

        function testCustomSignature() {
            const appId = document.getElementById('testAppId').value;
            const appKey = document.getElementById('testAppKey').value;
            const query = document.getElementById('testQuery').value;
            const salt = document.getElementById('testSalt').value;
            
            const customSign = generateCustomSign(appId, query, salt, appKey);
            const cryptoSign = generateCryptoJSSign(appId, query, salt, appKey);
            
            const signatureDiv = document.getElementById('signatureResults');
            
            let html = '<h4>ğŸ” è‡ªå®šä¹‰å‚æ•°ç­¾åæµ‹è¯•</h4>';
            html += `<div class="result"><strong>APP ID:</strong> ${appId}</div>`;
            html += `<div class="result"><strong>APP Key:</strong> ${appKey}</div>`;
            html += `<div class="result"><strong>æŸ¥è¯¢æ–‡æœ¬:</strong> ${query}</div>`;
            html += `<div class="result"><strong>Salt:</strong> ${salt}</div>`;
            html += `<div class="result"><strong>æ‹¼æ¥å­—ç¬¦ä¸²:</strong> ${appId + query + salt + appKey}</div>`;
            html += `<div class="result"><strong>è‡ªå®šä¹‰MD5ç­¾å:</strong> <code>${customSign}</code></div>`;
            html += `<div class="result"><strong>CryptoJS MD5ç­¾å:</strong> <code>${cryptoSign}</code></div>`;
            
            const isMatch = customSign === cryptoSign;
            html += `<div class="result ${isMatch ? 'success' : 'error'}">`;
            html += `<strong>ç­¾åå¯¹æ¯”ç»“æœ:</strong> ${isMatch ? 'âœ… åŒ¹é…' : 'âŒ ä¸åŒ¹é…'}`;
            html += '</div>';
            
            signatureDiv.innerHTML = html;
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
            document.getElementById('signatureResults').innerHTML = '';
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.addEventListener('load', function() {
            setTimeout(() => {
                runAllTests();
                testBaiduSignature();
            }, 1000);
        });
    </script>
</body>
</html>